##################################################################################
#                     Makefile for MATH tests for cuRNN                          #
##################################################################################

TARGET 					:= math_tests

##################################################################################
#                                  COMPILERS                                     #
##################################################################################

CXX 					:= g++
LXX                     := nvcc 
NXX 					:= nvcc -ccbin $(CXX)

##################################################################################
#                                INPUT FILES                                     #
##################################################################################

CXX_FILES				:= tests_math.cpp math.cpp

##################################################################################
#                                  INCLUDES                                      #
##################################################################################

INCLUDES 				:= -I/usr/local/cuda-7.0/include \
						   -I/usr/local/cuda-7.0/samples/common/inc		\
						   -I../math -I../util

##################################################################################
#                                   OBJECTS                                      #
##################################################################################

OBJS 					:= $(CXX_FILES:.cpp=.o)

##################################################################################
#                                  COMPILER FLAGS                                #
##################################################################################

CXX_FLAGS				:= -std=c++11 -O3 -g

##################################################################################
#                                  GENCODE FLAGS                                 #
##################################################################################

GENCODE_FLAGS         	:= -gencode arch=compute_30,code=sm_30

##################################################################################
#                               LIBRARY DIRECTORIES                              #
##################################################################################

CUDA_LDIRS 				:= -L/usr/local/cuda-7.0/lib64

##################################################################################
#                                   LIBRARIES                                    #
##################################################################################

CUDA_LIBS				:= -lcuda -lcublas -lcudart
CPP_LIBS				:= -lgtest -lgtest_main -lpthread -lstdc++ -lm

##################################################################################
#                                    BUILDING                                    #
##################################################################################

.PHONY: all 

all: $(TARGET)

$(TARGET): $(OBJS)
	$(NXX) $(GENCODE_FLAGS) $(OBJS) $(CPP_LIBS) $(CUDA_LDIRS) $(CUDA_LIBS) -o $(TARGET) 

%.o: %.cpp
	$(NXX) -x cu $(CXX_FLAGS) $(GENCODE_FLAGS) -I. -I.. $(INCLUDES) -dc $< -o $@ 

clean:
	rm -f *.o  ../util/*.o $(TARGET)